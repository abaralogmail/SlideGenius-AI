<div class="h-full flex flex-col bg-slate-50 relative">

  <!-- Header -->
  <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shrink-0 z-10">
    <div class="flex items-center gap-2 cursor-pointer" (click)="goToProjects()">
      <span class="material-icons text-indigo-600 text-3xl">auto_awesome_motion</span>
      <h1 class="text-xl font-bold text-slate-800 tracking-tight">SlideGenius AI</h1>
    </div>
    
    <div class="flex items-center gap-3">
      @if (viewState() === 'editor') {
        <div class="flex items-center gap-1 bg-slate-100 rounded-lg p-1">
          <button 
            (click)="exportProjectJson()"
            title="Export JSON"
            class="text-slate-600 hover:text-indigo-600 hover:bg-white px-3 py-1.5 rounded-md text-sm font-medium transition-all">
            JSON
          </button>
          <div class="w-px h-4 bg-slate-300"></div>
          <button 
            (click)="exportToPptx()"
            title="Export PowerPoint (PPTX)"
            class="text-slate-600 hover:text-indigo-600 hover:bg-white px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-1 transition-all">
            PPTX
          </button>
        </div>

        <button 
          (click)="startPresentation()"
          class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-all shadow-sm ml-2">
          <span class="material-icons text-sm">play_arrow</span>
          Present
        </button>
      }
      
      @if (viewState() === 'transcription_result') {
         <button 
          (click)="downloadTranscript()"
          class="text-slate-600 hover:text-slate-900 px-3 py-2 text-sm font-medium flex items-center gap-2 transition-colors border border-slate-200 rounded-lg hover:bg-white">
          <span class="material-icons text-sm">download</span>
          Download Text
        </button>
      }

      @if (viewState() !== 'projects') {
        <button 
            (click)="goToProjects()"
            class="text-slate-500 hover:text-indigo-600 p-2 rounded-full transition-colors"
            title="My Projects">
            <span class="material-icons">grid_view</span>
        </button>
      }
    </div>
  </header>

  <!-- Content Area -->
  <main class="flex-1 overflow-hidden relative">
    
    <!-- 1. Projects List View -->
    @if (viewState() === 'projects') {
      <div class="h-full overflow-y-auto p-8">
        <div class="max-w-6xl mx-auto">
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-slate-800">My Projects</h2>
            <div class="flex gap-2">
              <button 
                (click)="startCreate('transcription')"
                class="bg-white text-slate-600 border border-slate-200 px-4 py-2 rounded-xl font-medium hover:bg-slate-50 transition-all flex items-center gap-2">
                <span class="material-icons text-sm">mic</span>
                Transcribe Media
              </button>
              <button 
                (click)="startCreate('presentation')"
                class="bg-indigo-600 text-white px-5 py-2 rounded-xl font-medium shadow-md hover:bg-indigo-700 hover:shadow-lg transition-all flex items-center gap-2">
                <span class="material-icons">add</span>
                New Presentation
              </button>
            </div>
          </div>

          @if (projectService.projects().length === 0) {
            <div class="text-center py-20 bg-white rounded-2xl border border-dashed border-slate-300">
              <span class="material-icons text-slate-300 text-6xl mb-4">folder_open</span>
              <p class="text-lg text-slate-500 mb-6">No projects yet.</p>
              <div class="flex justify-center gap-4">
                 <button (click)="startCreate('presentation')" class="text-indigo-600 font-medium hover:underline">Create Presentation</button>
                 <span class="text-slate-300">|</span>
                 <button (click)="startCreate('transcription')" class="text-indigo-600 font-medium hover:underline">Transcribe Audio/Video</button>
              </div>
            </div>
          } @else {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              @for (project of projectService.projects(); track project.id) {
                <div 
                  (click)="openProject(project)"
                  class="bg-white rounded-xl p-5 border border-slate-200 shadow-sm hover:shadow-md hover:border-indigo-300 cursor-pointer transition-all group relative">
                  
                  <div class="flex items-start justify-between mb-4">
                    <div class="w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <span class="material-icons">slideshow</span>
                    </div>
                    <button 
                      (click)="deleteProject(project.id, $event)"
                      class="text-slate-300 hover:text-red-500 transition-colors p-1">
                      <span class="material-icons text-lg">delete</span>
                    </button>
                  </div>
                  
                  <h3 class="font-semibold text-slate-800 mb-1 truncate">{{ project.name }}</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    {{ project.slides.length }} slides â€¢ {{ project.createdAt | date:'mediumDate' }}
                  </p>
                  
                  <div class="flex items-center gap-2 text-xs text-slate-400">
                    <span class="px-2 py-0.5 bg-slate-100 rounded text-slate-500 uppercase font-bold">{{ project.language }}</span>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }

    <!-- 2. Create / Upload View -->
    @if (viewState() === 'create') {
      <div class="h-full flex flex-col items-center justify-center p-6 animate-[fadeIn_0.3s_ease-out]">
        <button (click)="goToProjects()" class="absolute top-6 left-6 text-slate-500 hover:text-slate-800 flex items-center gap-1">
            <span class="material-icons text-sm">arrow_back</span> Back
        </button>

        <div class="max-w-md w-full">
           <h2 class="text-2xl font-bold text-slate-800 mb-2 text-center">
             @if(creationMode() === 'presentation') { Create Presentation } @else { Transcribe Media }
           </h2>
           <p class="text-slate-500 mb-6 text-center">
             @if(creationMode() === 'presentation') {
               Upload a PDF or Image to generate slides.
             } @else {
               Upload Audio or Video to extract text.
             }
           </p>

           <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 mb-6">
             <!-- User Prompt Input -->
             <div class="mb-6">
               <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Instructions (Optional)</label>
               <textarea 
                  [(ngModel)]="userPrompt"
                  class="w-full text-sm p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none h-20"
                  placeholder="e.g. 'Focus on the financial data' or 'Summarize in Spanish'"></textarea>
             </div>

             <!-- Upload Area -->
             <label class="block relative group cursor-pointer text-center">
              <div class="bg-indigo-600 text-white font-semibold py-4 px-6 rounded-xl group-hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200 flex flex-col items-center justify-center gap-2">
                @if (isProcessing()) {
                  <span class="flex items-center justify-center gap-2">
                    <span class="animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"></span>
                    Processing...
                  </span>
                } @else {
                  <span class="material-icons text-2xl">
                     @if(creationMode() === 'presentation') { upload_file } @else { audio_file }
                  </span>
                  <span>Select File</span>
                }
              </div>
              <input 
                type="file" 
                [accept]="creationMode() === 'presentation' ? 'image/*,application/pdf' : 'audio/*,video/*'"
                (change)="onFileSelected($event)" 
                [disabled]="isProcessing()"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed">
            </label>
            <p class="text-xs text-slate-400 mt-4 text-center">
              @if(creationMode() === 'presentation') { Supports Images & PDF } @else { Supports Audio & Video (< 20MB) }
            </p>
           </div>
           
           <div class="text-center">
             <button 
               (click)="startCreate(creationMode() === 'presentation' ? 'transcription' : 'presentation')"
               class="text-indigo-600 text-sm font-medium hover:underline">
               Switch to @if(creationMode() === 'presentation') { Transcription } @else { Presentation }
             </button>
           </div>
        </div>
      </div>
    }

    <!-- 3. Transcription Result View -->
    @if (viewState() === 'transcription_result') {
      <div class="h-full overflow-hidden flex flex-col">
        <div class="flex-1 overflow-y-auto p-8 bg-slate-50">
          <div class="max-w-3xl mx-auto bg-white p-10 rounded-xl shadow-sm border border-slate-200 min-h-[600px]">
            <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b border-slate-100 pb-4">
              <span class="material-icons text-indigo-600">description</span>
              Transcription Result
            </h2>
            <div class="prose prose-slate max-w-none whitespace-pre-wrap text-slate-700 leading-relaxed">
              {{ transcriptionResult() }}
            </div>
          </div>
        </div>
      </div>
    }

    <!-- 4. Editor View (Existing) -->
    @if (viewState() === 'editor' && currentProject() && activeSlide()) {
      <div class="h-full flex overflow-hidden">
        <!-- Sidebar: Slide List -->
        <div class="w-72 bg-white border-r border-slate-200 flex flex-col shrink-0 overflow-hidden">
          
          <!-- Project Settings -->
          <div class="p-4 border-b border-slate-100 space-y-3 bg-slate-50/50">
            <div>
              <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Project Name</label>
              <input 
                [ngModel]="currentProject()?.name"
                (ngModelChange)="updateProjectName($event)"
                (blur)="saveCurrentProject()"
                class="w-full text-sm font-semibold text-slate-700 bg-white border border-slate-200 rounded px-2 py-1 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <!-- Language / Region Selector -->
            <div>
               <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Language & Region</label>
               <select 
                 [ngModel]="currentProject()?.language"
                 (ngModelChange)="updateProjectLanguage($event)"
                 class="w-full text-xs text-slate-700 bg-white border border-slate-200 rounded px-2 py-1.5 focus:ring-1 focus:ring-indigo-500 outline-none">
                 @for (lang of languages; track lang.code) {
                   <option [value]="lang.code">{{ lang.name }}</option>
                 }
                 <!-- Fallback for unknown detected languages -->
                 @if (!isKnownLanguage(currentProject()?.language)) {
                    <option [value]="currentProject()?.language">{{ currentProject()?.language }}</option>
                 }
               </select>
            </div>

            <div>
               <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Narration Voice</label>
               <select 
                 [ngModel]="currentProject()?.selectedVoiceURI"
                 (ngModelChange)="updateVoice($event)"
                 class="w-full text-xs text-slate-700 bg-white border border-slate-200 rounded px-2 py-1.5 focus:ring-1 focus:ring-indigo-500 outline-none">
                 <option [value]="undefined">Default (Auto)</option>
                 @for (voice of filteredVoices(); track voice.voiceURI) {
                   <option [value]="voice.voiceURI">{{ voice.name }} ({{voice.lang}})</option>
                 }
               </select>
            </div>
          </div>

          <div class="flex-1 overflow-y-auto p-2 space-y-2">
            @for (slide of currentProject()?.slides; track slide.id; let idx = $index) {
              <div 
                (click)="selectSlide(idx)"
                class="p-3 rounded-lg cursor-pointer border transition-all hover:shadow-sm group relative"
                [class]="activeSlideIndex() === idx ? 'bg-indigo-50 border-indigo-200' : 'bg-white border-slate-200 hover:border-indigo-300'">
                <div class="flex items-center gap-3">
                  <div class="w-6 h-6 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-bold shrink-0">
                    {{ idx + 1 }}
                  </div>
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-slate-700 truncate">{{ slide.title }}</p>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Main Editor -->
        <div class="flex-1 overflow-y-auto bg-slate-50 p-8 relative">
          <div class="max-w-5xl mx-auto space-y-6">
            
            <!-- Slide Preview Card (Enforced 16:9) -->
            <!-- We use 'block' and 'aspect-video' to ensure the container is a perfect 16:9 rectangle -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden w-full aspect-video relative group block">
              
              @if (activeSlide()!.imageSettings?.layout === 'background' && activeSlide()!.generatedImage) {
                 <!-- Full Background Mode: Forced absolute inset-0 -->
                 <div class="absolute inset-0 z-0 bg-slate-900 w-full h-full">
                    <img 
                      [src]="activeSlide()!.generatedImage" 
                      class="w-full h-full transition-transform duration-300 ease-out"
                      style="object-fit: cover !important;"
                      [style.transform]="'scale(' + (activeSlide()!.imageSettings?.scale || 1) + ')'"
                      [style.object-position]="(activeSlide()!.imageSettings?.x || 50) + '% ' + (activeSlide()!.imageSettings?.y || 50) + '%'">
                    <!-- Overlay for text readability -->
                    <div class="absolute inset-0 bg-white/70 backdrop-blur-[1px]"></div>
                 </div>

                 <!-- Content On Top -->
                 <div class="relative z-10 w-full h-full p-8 md:p-12 flex flex-col justify-center overflow-hidden">
                    <input 
                      [(ngModel)]="activeSlide()!.title"
                      (blur)="saveCurrentProject()"
                      class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 md:mb-6 bg-transparent border-none focus:ring-0 placeholder-slate-500 w-full drop-shadow-sm" 
                      placeholder="Slide Title">
                    
                    <ul class="space-y-3 md:space-y-4 overflow-y-auto pr-2">
                      @for (point of activeSlide()!.content; track $index) {
                        <li class="flex items-start gap-3">
                          <span class="w-2 h-2 rounded-full bg-indigo-600 mt-2.5 shrink-0 shadow-sm"></span>
                          <textarea 
                            [(ngModel)]="activeSlide()!.content[$index]"
                            (blur)="saveCurrentProject()"
                            rows="1"
                            class="flex-1 text-lg md:text-xl text-slate-800 bg-transparent border-none focus:ring-0 resize-none overflow-hidden font-medium drop-shadow-sm"
                            oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                        </li>
                      }
                    </ul>
                 </div>
                 
                 <!-- Edit Image Button Floating -->
                 <button 
                    (click)="toggleImageEditor(activeSlide()!.id)"
                    class="absolute bottom-4 right-4 z-20 bg-white/90 backdrop-blur text-slate-800 px-4 py-2 rounded-full font-medium shadow-lg hover:bg-white transition-colors flex items-center gap-2 text-xs border border-slate-200">
                    <span class="material-icons text-sm">tune</span>
                    Edit Background
                 </button>

              } @else {
                 <!-- Split Mode (Default) -->
                 <div class="flex flex-col md:flex-row w-full h-full">
                    <!-- Left: Text Content -->
                    <div class="flex-1 p-8 md:p-12 flex flex-col justify-center overflow-hidden">
                      <input 
                        [(ngModel)]="activeSlide()!.title"
                        (blur)="saveCurrentProject()"
                        class="text-3xl font-bold text-slate-800 mb-6 bg-transparent border-none focus:ring-0 placeholder-slate-300 w-full" 
                        placeholder="Slide Title">
                      
                      <ul class="space-y-3 overflow-y-auto pr-2">
                        @for (point of activeSlide()!.content; track $index) {
                          <li class="flex items-start gap-3">
                            <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2.5 shrink-0"></span>
                            <textarea 
                              [(ngModel)]="activeSlide()!.content[$index]"
                              (blur)="saveCurrentProject()"
                              rows="1"
                              class="flex-1 text-lg text-slate-600 bg-transparent border-none focus:ring-0 resize-none overflow-hidden"
                              oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                          </li>
                        }
                      </ul>
                    </div>

                    <!-- Right: Image Area -->
                    <div 
                      class="bg-slate-100 border-l border-slate-200 relative group flex items-center justify-center overflow-hidden h-64 md:h-full slide-image-col"
                      [style.--slide-image-width]="(activeSlide()!.imageSettings?.width || 50) + '%'">
                      
                      @if (activeSlide()!.generatedImage) {
                        <!-- Image Container for Clip -->
                        <div class="w-full h-full relative overflow-hidden">
                            <img 
                              [src]="activeSlide()!.generatedImage" 
                              class="max-w-none absolute transition-transform duration-300 ease-out"
                              [style.width]="'100%'"
                              [style.height]="'100%'"
                              [style.object-fit]="activeSlide()!.imageSettings?.fit || 'contain'"
                              [style.transform]="'scale(' + (activeSlide()!.imageSettings?.scale || 1) + ')'"
                              [style.object-position]="(activeSlide()!.imageSettings?.x || 50) + '% ' + (activeSlide()!.imageSettings?.y || 50) + '%'">
                        </div>
                        
                        <!-- Hover Actions -->
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2">
                          <button 
                            (click)="toggleImageEditor(activeSlide()!.id)"
                            class="bg-white text-slate-900 px-4 py-2 rounded-lg font-medium shadow-lg hover:bg-slate-50 transition-colors flex items-center gap-2">
                            <span class="material-icons text-sm">tune</span>
                            Edit Image
                          </button>
                        </div>
                      } @else {
                        <div class="text-center p-6">
                          <span class="material-icons text-slate-300 text-5xl mb-2">image</span>
                          <p class="text-sm text-slate-400 mb-4">No image generated</p>
                          <button 
                            (click)="toggleImageGenerator(activeSlide()!.id)"
                            class="bg-white border border-slate-300 text-slate-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors shadow-sm">
                            Generate AI Image
                          </button>
                        </div>
                      }
                    </div>
                 </div>
              }
            </div>

            <!-- Overlays: Image Generator OR Image Editor -->
            
            <!-- Editor Overlay -->
            @if (showImageEditorForSlideId() === activeSlide()!.id) {
               <div class="relative z-20">
                 <app-image-editor
                    [inputImage]="activeSlide()!.generatedImage"
                    [initialSettings]="activeSlide()!.imageSettings"
                    [initialPrompt]="activeSlide()!.imagePrompt"
                    (cancel)="showImageEditorForSlideId.set(null)"
                    (saveChanges)="onImageEdited(activeSlide()!.id, $event)">
                 </app-image-editor>
               </div>
            }

            <!-- Generator Overlay -->
            @if (showImageGeneratorForSlideId() === activeSlide()!.id) {
              <div class="relative z-20">
                <app-image-generator
                  [initialPrompt]="activeSlide()!.imagePrompt"
                  (cancel)="showImageGeneratorForSlideId.set(null)"
                  (imageGenerated)="onImageGenerated(activeSlide()!.id, $event)">
                </app-image-generator>
              </div>
            }

            <!-- Speaker Notes -->
            <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100">
              <h3 class="text-xs font-bold text-indigo-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                <span class="material-icons text-sm">record_voice_over</span>
                Speaker Notes (Script)
              </h3>
              <textarea 
                [(ngModel)]="activeSlide()!.speakerNotes"
                (blur)="saveCurrentProject()"
                class="w-full bg-transparent border-none focus:ring-0 text-slate-700 leading-relaxed resize-none h-32"
                placeholder="Enter speaker notes here..."></textarea>
            </div>

          </div>
        </div>
      </div>
    }

    <!-- 5. Presentation View (Existing) -->
    @if (viewState() === 'present' && activeSlide()) {
      <div class="absolute inset-0 z-50 bg-black text-white flex flex-col">
        
        <!-- Main Stage -->
        <div class="flex-1 flex relative overflow-hidden">
          
          <!-- Conditional Layout for Presentation -->
          @if (activeSlide()!.imageSettings?.layout === 'background') {
             <!-- Full Background Layout: Force Full Screen Cover -->
             <div class="absolute inset-0 z-0 w-full h-full">
                @if (activeSlide()!.generatedImage) {
                  <img 
                    [src]="activeSlide()!.generatedImage" 
                    class="w-full h-full transition-transform duration-1000 ease-in-out"
                    style="object-fit: cover !important;"
                    [style.transform]="'scale(' + (activeSlide()!.imageSettings?.scale || 1) + ')'"
                    [style.object-position]="(activeSlide()!.imageSettings?.x || 50) + '% ' + (activeSlide()!.imageSettings?.y || 50) + '%'">
                  <div class="absolute inset-0 bg-black/50"></div>
                } @else {
                  <div class="absolute inset-0 bg-gradient-to-br from-slate-900 to-indigo-900"></div>
                }
             </div>

             <div class="relative z-10 flex-1 flex flex-col justify-center p-12 md:p-24 text-center">
                <h2 class="text-5xl md:text-6xl font-bold mb-12 leading-tight drop-shadow-lg animate-[fadeIn_0.8s_ease-out]">
                  {{ activeSlide()!.title }}
                </h2>
                <ul class="space-y-8 text-xl md:text-3xl font-light text-slate-100 inline-block text-left mx-auto">
                  @for (point of activeSlide()!.content; track $index) {
                    <li class="flex items-start gap-4 animate-[slideInUp_0.5s_ease-out_forwards]" [style.animation-delay]="$index * 200 + 'ms'">
                      <span class="w-3 h-3 rounded-full bg-indigo-400 mt-4 shrink-0 shadow-[0_0_10px_rgba(129,140,248,0.8)]"></span>
                      <span class="drop-shadow-md">{{ point }}</span>
                    </li>
                  }
                </ul>
             </div>

          } @else {
             <!-- Split Layout (Image Right, Text Left) -->
             <div class="w-full h-full flex flex-col md:flex-row">
                <!-- Text Left -->
                <div class="flex-1 flex flex-col justify-center p-12 md:p-24 relative z-10 bg-slate-900">
                  <h2 class="text-5xl md:text-6xl font-bold mb-12 leading-tight drop-shadow-lg animate-[fadeIn_0.8s_ease-out] text-white">
                    {{ activeSlide()!.title }}
                  </h2>
                  <ul class="space-y-8 text-xl md:text-3xl font-light text-slate-300">
                    @for (point of activeSlide()!.content; track $index) {
                      <li class="flex items-start gap-4 animate-[slideInRight_0.5s_ease-out_forwards]" [style.animation-delay]="$index * 200 + 'ms'">
                        <span class="w-3 h-3 rounded-full bg-indigo-500 mt-4 shrink-0 shadow-[0_0_10px_rgba(129,140,248,0.8)]"></span>
                        <span class="drop-shadow-md">{{ point }}</span>
                      </li>
                    }
                  </ul>
                </div>
                
                <!-- Image Right -->
                <div class="flex-1 relative overflow-hidden bg-black h-64 md:h-full">
                   @if (activeSlide()!.generatedImage) {
                      <img 
                        [src]="activeSlide()!.generatedImage" 
                        class="w-full h-full object-cover transition-transform duration-1000 ease-in-out"
                        [style.object-fit]="activeSlide()!.imageSettings?.fit || 'contain'"
                        [style.transform]="'scale(' + (activeSlide()!.imageSettings?.scale || 1) + ')'"
                        [style.object-position]="(activeSlide()!.imageSettings?.x || 50) + '% ' + (activeSlide()!.imageSettings?.y || 50) + '%'">
                   }
                </div>
             </div>
          }

        </div>

        <!-- Captions / Subtitles Overlay -->
        <div class="h-32 bg-black/80 flex items-center justify-center px-8 text-center shrink-0 border-t border-white/10 z-20">
           <p class="text-2xl text-yellow-300 font-medium leading-relaxed max-w-5xl">
             <span class="opacity-80 italic">"</span>
             {{ activeSlide()!.speakerNotes }}
             <span class="opacity-80 italic">"</span>
           </p>
        </div>

        <!-- Controls -->
        <div class="h-16 bg-slate-900 border-t border-slate-800 flex items-center justify-between px-6 shrink-0 z-20">
          <button (click)="exitPresentation()" class="text-slate-400 hover:text-white flex items-center gap-2 transition-colors">
            <span class="material-icons">close</span>
            Exit
          </button>
          
          <div class="flex items-center gap-4">
             <button 
               (click)="prevSlide()" 
               [disabled]="activeSlideIndex() === 0"
               class="p-2 rounded-full hover:bg-slate-800 disabled:opacity-30 transition-colors">
               <span class="material-icons text-3xl">skip_previous</span>
             </button>
             <span class="text-sm font-mono text-slate-500">{{ activeSlideIndex() + 1 }} / {{ currentProject()!.slides.length }}</span>
             <button 
               (click)="nextSlide()" 
               [disabled]="activeSlideIndex() === currentProject()!.slides.length - 1"
               class="p-2 rounded-full hover:bg-slate-800 disabled:opacity-30 transition-colors">
               <span class="material-icons text-3xl">skip_next</span>
             </button>
          </div>

          <div class="flex items-center gap-2 w-32">
             <span class="material-icons text-slate-500 text-sm">volume_up</span>
             <input type="range" min="0" max="1" step="0.1" (input)="ttsService.setMusicVolume($any($event.target).value)" class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer">
          </div>
        </div>

      </div>
    }
  </main>
  
  <footer class="bg-white border-t border-slate-200 px-6 py-2 text-xs text-slate-400 flex justify-between items-center shrink-0 z-10">
    <div>&copy; 2024 SlideGenius AI</div>
    <div class="flex items-center gap-4">
      <span title="Prompt Tokens">Input: {{ geminiService.totalTokenUsage().input | number }}</span>
      <span title="Response Tokens">Output: {{ geminiService.totalTokenUsage().output | number }}</span>
      <span class="font-bold text-slate-600" title="Total Tokens">Total: {{ geminiService.totalTokenUsage().total | number }}</span>
    </div>
  </footer>
</div>